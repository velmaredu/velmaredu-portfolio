---
import "../styles/header.css";
import MenuIcon from "@/icons/MenuIcon.astro";

const pages = [
  "Home",
  "Experience",
  "Projects",
  "Education",
  "Skills",
  "About",
  "Contact",
];
---

<header>
  <a href='/'>Eduardo Velasco</a>

  <nav class='hidden md:flex'>
    {pages.map((page) => <a href={`/#${page.toLowerCase()}`}>{page}</a>)}
  </nav>

  <a id='hamburguer' role='button' aria-expanded='false' aria-controls='menu'>
    <MenuIcon />
  </a>

  <nav id='mobile-nav'>
    {pages.map((page) => <a href={`/#${page.toLowerCase()}`}>{page}</a>)}
    <div class='splash'></div>
  </nav>
</header>
<script>
  //Highliht the active section in the nav
  const $navAElements: Element[] = [
    ...document.querySelectorAll("header nav a"),
  ];

  window.addEventListener("scroll", () => {
    $navAElements.forEach((a) => {
      const selectionForSection = a.getAttribute("href")?.substring(1);
      const sectionElement: HTMLDivElement | null = document.querySelector(
        selectionForSection || ""
      );

      if (!sectionElement) return;
      const selectionTop = sectionElement.offsetTop - 150;
      if (window.scrollY <= selectionTop) return;
      $navAElements.forEach((aToRemove) =>
        aToRemove.classList.remove("active")
      );
      a.classList.add("active");
    });
  });

  // TOGGLE MOBILE NAV
  const nav: HTMLElement = document.querySelector("#mobile-nav") as HTMLElement;
  const menuIcon: HTMLElement = document.querySelector(
    "#hamburguer"
  ) as HTMLElement;
  const navLinks: NodeListOf<Element> =
    document.querySelectorAll("#mobile-nav a");
  let isMenuOpen = false;

  menuIcon.addEventListener("click", (e) => {
    e.preventDefault();
    isMenuOpen = !isMenuOpen;

    menuIcon.setAttribute("aria-expanded", String(isMenuOpen));
    menuIcon.classList.toggle("open");
    nav.hidden = !isMenuOpen;
    nav.classList.toggle("open");
  });

  navLinks.forEach((link) => {
    link.addEventListener("click", () => {
      isMenuOpen = false;
      menuIcon.setAttribute("aria-expanded", String(isMenuOpen));
      menuIcon.classList.remove("open");
      nav.hidden = true;
      nav.classList.remove("open");
    });
  });
</script>
